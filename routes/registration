const express = require('express');
const db = require('../db/index');
const bodyParser = require('body-parser');

const registerRouter = express.Router();

registerRouter.use(bodyParser.json());
registerRouter.use(
  bodyParser.urlencoded({
    extended: true,
  })
);

registerRouter.get('/', (req, res) => {
  db.query('SELECT * FROM users', (error, results) => {
    if (error) {
      console.log('error')
      throw error
    }
    console.log(results.rows)
    res.status(200).json(results.rows)
  })
});

registerRouter.post('/', (req, res, next) => {
  const { first, last, username, email } = req.body;
  const text = 'INSERT INTO users (first_name, last_name, username, email)VALUES($1, $2, $3, $4) RETURNING *';
  const values = [first, last, username, email]
  db.query(text, values, (error, results) => {
    if (error) {
      console.log('error')
      throw error
    }
    console.log(results.rows[0])
    res.status(200).json(results.rows[0])
  })
})

module.exports = registerRouter;